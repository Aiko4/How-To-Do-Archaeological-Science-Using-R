<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>How To Do Archaeological Science Using R</title>
  <meta name="description" content="This is a early draft edited volume of contributions to the ‘How To Do Archaeological Science Using R’ forum of the 2017 Society of American Archaeology annual meeting.">
  <meta name="generator" content="bookdown 0.3.16 and GitBook 2.6.7">

  <meta property="og:title" content="How To Do Archaeological Science Using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a early draft edited volume of contributions to the ‘How To Do Archaeological Science Using R’ forum of the 2017 Society of American Archaeology annual meeting." />
  <meta name="github-repo" content="benmarwick/How-to-do-archaeological-science-using-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="How To Do Archaeological Science Using R" />
  
  <meta name="twitter:description" content="This is a early draft edited volume of contributions to the ‘How To Do Archaeological Science Using R’ forum of the 2017 Society of American Archaeology annual meeting." />
  

<meta name="author" content="Ben Marwick (editor)">


<meta name="date" content="2017-03-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html">
<link rel="next" href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.8/htmlwidgets.js"></script>
<link href="libs/leaflet-0.7.7/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-0.7.7/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<link href="libs/leaflet-label-0.2.2/leaflet.label.css" rel="stylesheet" />
<script src="libs/leaflet-label-0.2.2/leaflet.label.js"></script>
<script src="libs/Proj4Leaflet-0.7.2/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-0.7.2/proj4leaflet.js"></script>
<script src="libs/leaflet-binding-1.1.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.0.27/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-1.1.0/leaflet-providers-plugin.js"></script>
<link href="libs/plotlyjs-1.16.3/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.16.3/plotly-latest.min.js"></script>
<script src="libs/plotly-binding-4.5.6/plotly.js"></script>
<script async defer src="https://hypothes.is/embed.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-88838732-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">How To Do Archaeological Science Using R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="basic-spatial-analysis-in-r-point-pattern-analysis.html"><a href="basic-spatial-analysis-in-r-point-pattern-analysis.html"><i class="fa fa-check"></i><b>2</b> Basic spatial analysis in R: Point pattern analysis</a><ul>
<li class="chapter" data-level="2.0.1" data-path="basic-spatial-analysis-in-r-point-pattern-analysis.html"><a href="basic-spatial-analysis-in-r-point-pattern-analysis.html#introduction-1"><i class="fa fa-check"></i><b>2.0.1</b> Introduction</a></li>
<li class="chapter" data-level="2.0.2" data-path="basic-spatial-analysis-in-r-point-pattern-analysis.html"><a href="basic-spatial-analysis-in-r-point-pattern-analysis.html#summary"><i class="fa fa-check"></i><b>2.0.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html"><a href="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html"><i class="fa fa-check"></i><b>3</b> Using linear models to explore children’s institutions in urban areas</a><ul>
<li class="chapter" data-level="3.0.1" data-path="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html"><a href="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html#introduction-2"><i class="fa fa-check"></i><b>3.0.1</b> Introduction</a></li>
<li class="chapter" data-level="3.0.2" data-path="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html"><a href="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html#summary-1"><i class="fa fa-check"></i><b>3.0.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><i class="fa fa-check"></i><b>4</b> Agent-based modelling prehistoric landscape use with R and NetLogo</a><ul>
<li class="chapter" data-level="4.0.1" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#introduction-3"><i class="fa fa-check"></i><b>4.0.1</b> Introduction</a></li>
<li class="chapter" data-level="4.0.2" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#agent-based-modeling-with-netlogo-and-r"><i class="fa fa-check"></i><b>4.0.2</b> Agent-based modeling with NetLogo and R</a></li>
<li class="chapter" data-level="4.0.3" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#starting-netlogo-from-r"><i class="fa fa-check"></i><b>4.0.3</b> Starting NetLogo from R</a></li>
<li class="chapter" data-level="4.0.4" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#running-a-netlogo-model-from-r"><i class="fa fa-check"></i><b>4.0.4</b> Running a NetLogo model from R</a></li>
<li class="chapter" data-level="4.0.5" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#getting-data-back-from-netlogo"><i class="fa fa-check"></i><b>4.0.5</b> Getting data back from NetLogo</a></li>
<li class="chapter" data-level="4.0.6" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#plotting-the-data"><i class="fa fa-check"></i><b>4.0.6</b> Plotting the data</a></li>
<li class="chapter" data-level="4.0.7" data-path="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html"><a href="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo.html#quitting-netlogo-from-r"><i class="fa fa-check"></i><b>4.0.7</b> Quitting NetLogo from R</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><i class="fa fa-check"></i><b>5</b> Tempo Plots in R for Analysing Radiocarbon Dates</a><ul>
<li class="chapter" data-level="5.0.1" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#archaeological-motivation"><i class="fa fa-check"></i><b>5.0.1</b> Archaeological Motivation</a></li>
<li class="chapter" data-level="5.0.2" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#obtain-mcmc-output-from-calibration-software"><i class="fa fa-check"></i><b>5.0.2</b> Obtain MCMC Output from Calibration Software</a></li>
<li class="chapter" data-level="5.0.3" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#read-oxcal-mcmc-output"><i class="fa fa-check"></i><b>5.0.3</b> Read OxCal MCMC Output</a></li>
<li class="chapter" data-level="5.0.4" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#select-and-confirm-columns-to-plot"><i class="fa fa-check"></i><b>5.0.4</b> Select and Confirm Columns to Plot</a></li>
<li class="chapter" data-level="5.0.5" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#load-and-run-calc.tempo-function"><i class="fa fa-check"></i><b>5.0.5</b> Load and Run <code>calc.tempo</code> Function</a></li>
<li class="chapter" data-level="5.0.6" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#check-calc.tempo-output"><i class="fa fa-check"></i><b>5.0.6</b> Check <code>calc.tempo</code> Output</a></li>
<li class="chapter" data-level="5.0.7" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#example-plot-with-plot.tempo"><i class="fa fa-check"></i><b>5.0.7</b> Example Plot with <code>plot.tempo</code></a></li>
<li class="chapter" data-level="5.0.8" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#archaeophases-software"><i class="fa fa-check"></i><b>5.0.8</b> ArchaeoPhases software</a></li>
<li class="chapter" data-level="5.0.9" data-path="tempo-plots-in-r-for-analysing-radiocarbon-dates.html"><a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html#demo-files"><i class="fa fa-check"></i><b>5.0.9</b> Demo Files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="using-r-as-a-gis-working-with-raster-and-vector-data.html"><a href="using-r-as-a-gis-working-with-raster-and-vector-data.html"><i class="fa fa-check"></i><b>6</b> Using R as a GIS: working with raster and vector data</a><ul>
<li class="chapter" data-level="6.0.1" data-path="using-r-as-a-gis-working-with-raster-and-vector-data.html"><a href="using-r-as-a-gis-working-with-raster-and-vector-data.html#introduction-4"><i class="fa fa-check"></i><b>6.0.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="using-r-to-analyse-occupation-as-a-function-of-geographical-variables-using-logistic-regression-.html"><a href="using-r-to-analyse-occupation-as-a-function-of-geographical-variables-using-logistic-regression-.html"><i class="fa fa-check"></i><b>7</b> Using R to analyse occupation as a function of geographical variables using logistic regression.</a><ul>
<li class="chapter" data-level="7.1" data-path="using-r-to-analyse-occupation-as-a-function-of-geographical-variables-using-logistic-regression-.html"><a href="using-r-to-analyse-occupation-as-a-function-of-geographical-variables-using-logistic-regression-.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html"><i class="fa fa-check"></i><b>8</b> Landscape-based Hypothesis Testing in R</a><ul>
<li class="chapter" data-level="8.1" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#introduction-6"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#learning-goals"><i class="fa fa-check"></i><b>8.2</b> Learning goals</a></li>
<li class="chapter" data-level="8.3" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#loading-necessary-packages"><i class="fa fa-check"></i><b>8.3</b> Loading necessary packages</a></li>
<li class="chapter" data-level="8.4" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#defining-the-study-area"><i class="fa fa-check"></i><b>8.4</b> Defining the study area</a></li>
<li class="chapter" data-level="8.5" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#reading-site-locations-from-a-table-and-cropping-to-a-study-area"><i class="fa fa-check"></i><b>8.5</b> Reading “site” locations from a table and cropping to a study area</a></li>
<li class="chapter" data-level="8.6" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#visualizing-site-locations"><i class="fa fa-check"></i><b>8.6</b> Visualizing site locations</a></li>
<li class="chapter" data-level="8.7" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#downloading-landscape-data-with-feddata"><i class="fa fa-check"></i><b>8.7</b> Downloading landscape data with <em>FedData</em></a></li>
<li class="chapter" data-level="8.8" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#are-sites-situated-based-on-elevation"><i class="fa fa-check"></i><b>8.8</b> Are sites situated based on elevation?</a><ul>
<li class="chapter" data-level="8.8.1" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#extract-site-elevations"><i class="fa fa-check"></i><b>8.8.1</b> Extract site elevations</a></li>
<li class="chapter" data-level="8.8.2" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#calculate-kernel-density-curves-for-sites-and-landscape"><i class="fa fa-check"></i><b>8.8.2</b> Calculate kernel density curves for sites and landscape</a></li>
<li class="chapter" data-level="8.8.3" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#plot-the-kernel-density-curves"><i class="fa fa-check"></i><b>8.8.3</b> Plot the kernel density curves</a></li>
<li class="chapter" data-level="8.8.4" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#mann-whitney-u-test-comparing-non-normal-distributions"><i class="fa fa-check"></i><b>8.8.4</b> Mann-Whitney U test comparing non-normal distributions</a></li>
<li class="chapter" data-level="8.8.5" data-path="landscape-based-hypothesis-testing-in-r.html"><a href="landscape-based-hypothesis-testing-in-r.html#references-cited"><i class="fa fa-check"></i><b>8.8.5</b> References cited</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">How To Do Archaeological Science Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">

<div class = rmdreview>
This book is in <b><a href="open.html#open">Open Review</a></b>. I want your feedback to make the book better for you and other readers. To add your annotation, <span style="background-color: #3297FD; color: white">select some text</span> and then click the <i class="h-icon-annotate"></i> on the pop-up menu. To see the annotations of others, click the <i class="h-icon-chevron-left"></i> in the upper right hand corner of the page <i class="fa fa-arrow-circle-right  fa-rotate-315" aria-hidden="true"></i>
</div>
<div id="agent-based-modelling-prehistoric-landscape-use-with-r-and-netlogo" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Agent-based modelling prehistoric landscape use with R and NetLogo</h1>
<p>Ben Davies</p>
<p>Built using R version 3.3.3 and NetLogo version 6.0.</p>
<div id="introduction-3" class="section level3">
<h3><span class="header-section-number">4.0.1</span> Introduction</h3>
<p>Where I work in western New South Wales, Australia, heat retainer hearths are a common feature of archaeological landscapes. The hearths are manifest as concentrations of fire-altered stone on the surface. Sometimes, these concentrations protect dense caps of burned sediment and charcoal, the latter of which can be used to date the hearths.</p>
<p>The temporal distribution of dates obtained from hearths at Rutherfords Creek show two patterns: a superlinear increase in the frequency of dates through time, and episodic gaps in the chronometric data. The increasing frequency of dates is typically explained in terms of either population growth or taphonomic loss, while the gaps are variously explained as being the result of periods of temporary abandonment, or cyclical expanasions and contractions of foraging ranges.</p>
<p>The visibility of these hearths, and their retention of charcoal, is largely a product of a fluvial geomorphic environment, where episodic flood move sediment around the landscape. This tutorial draws on a study aimed at understanding how the frequency of erosion and deposition affects the distribution of datable features in a surface context.</p>
</div>
<div id="agent-based-modeling-with-netlogo-and-r" class="section level3">
<h3><span class="header-section-number">4.0.2</span> Agent-based modeling with NetLogo and R</h3>
<p>This tutorial demonstrates the use of the <code>RNetLogo</code> package to facilitate the analysis of NetLogo agent-based models. Agent-based models are computer simulations in which individual system components (often in the form of autonomous computational “agents”) interact with each other and/or their environment according to a given set of rules. These micro-level interactions can generate macro-level regularities over time, allowing the modeller to observe the emergence of these larger patterns or entities as outcomes of smaller-scale activities.</p>
<p><a href="https://ccl.northwestern.edu/netlogo/">NetLogo</a> is a modeling environment used to build agent-basd models. NetLogo can interface directly with R in two ways: either through an <a href="https://ccl.northwestern.edu/netlogo/docs/r.html">extension</a> that comes bundled with NetLogo , or through the <a href="https://cran.r-project.org/web/packages/RNetLogo/index.html"><code>RNetLogo</code></a> package in R. Both of these were developed by Jan C. Thiele.</p>
<p>This tutorial uses a NetLogo model called <strong>HMODEL</strong>, aimed at understanding how the frequency of erosion and deposition affects the distribution of datable features in a surface context. Before getting started, you’ll need to make sure that you have NetLogo, R, and the RNetLogo package installed.</p>
</div>
<div id="starting-netlogo-from-r" class="section level3">
<h3><span class="header-section-number">4.0.3</span> Starting NetLogo from R</h3>
<p>First, add the RNetLogo package to your current R session:</p>
<p>Next, we need to tell R where to find NetLogo is stored, specifically where the <strong>NetLogo.jar</strong> file is stored. On a Windows machine, this is probably somewhere like C:\Program Files\NetLogo 6.0\app (this can be edited below to locate this file on your machine). Once the NetLogo.jar file has been located, the code will identify the directory where it is located, then start NetLogo from R.</p>
<p>To open a model, we need to tell R where the NetLogo file is located using the <code>NLLoadModel</code> function. The working directory, however, now been changed from the folder where this document is located to the folder where the NetLogo This code will open the <strong>hmodel.nlogo</strong> file by referring back to the home folder.</p>
</div>
<div id="running-a-netlogo-model-from-r" class="section level3">
<h3><span class="header-section-number">4.0.4</span> Running a NetLogo model from R</h3>
<p>The RNetLogo extension calls out to NetLogo’s command line using the NLCommand and NLDoCommand functions. These will either perform one command, or perform them a preset number of times. So we can use NLCommand to run the setup routine and set parameters (in this case, surface stability), and we can use NLDoCommand to run the simulation for 2000 time steps (on the 2001st step, the simulation collects data).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">NLCommand</span>(<span class="st">&quot;Setup&quot;</span>) <span class="co">#runs the NetLogo setup command</span>
<span class="kw">NLCommand</span>(<span class="st">&quot;random-seed 4321&quot;</span>) <span class="co">#sets the random number seed</span>
<span class="kw">NLCommand</span>(<span class="st">&quot;set surface_stability 0&quot;</span>) <span class="co">#sets the surface_stability parameter</span>
<span class="kw">NLDoCommand</span>(<span class="dv">2001</span>,<span class="st">&quot;Go&quot;</span>) <span class="co">#runs the model for 2000 iterations</span></code></pre></div>
<p>If you switch to the NetLogo GUI, you can see HMODEL operating. In the model, simulated agents move randomly from point to point within a gridded space, constructing hearths, shown as an X, at a constant rate. Hearths contain an “age” which records the date the hearth was formed in years before present. If nothing else were to happen, the record would show no change through time.</p>
<p>Grid cells also contain a set of sedimentary layers, each of these also containing an age, with new hearths being constructed on the surface. At a given interval, an event will occur with one of two outcomes: erosion or deposition. If erosion occurs, the top layer of sediment erodes, any hearths situated on that surface lose their charcoal and become , while surfaces underneath become visible. If deposition occurs, a layer of sediment is added to the cell, and any hearths visible on the surface become hidden and thus undetectable in a surface survey.</p>
<div class="figure">
<img src="03_Davies/hmodel_diagram.jpg" alt="Diagram of HMODEL" />
<p class="caption">Diagram of HMODEL</p>
</div>
<p>This simulation runs from 2000 BP to present, with hearth construction ceasing at 200 BP. At the end of the simulation, we can sample the hearths sitting on the surface and compare the chronologies we obtain from them. Hearths can be dated based on radiocarbon (for hearths containing charcoal), or optically stimulated luminsence (for hearth stones). The model keeps track of all hearths above and beneath the surface, as well as the intervening stratigraphic layers, so in effect the model can be “excavated”.</p>
</div>
<div id="getting-data-back-from-netlogo" class="section level3">
<h3><span class="header-section-number">4.0.5</span> Getting data back from NetLogo</h3>
<p>First, we’ll use the ‘NLReport’ function to get lists of 100 randomly chosen hearths from three populations: visible hearths with charcoal that can be dated using radiocarbon, visible hearths with or without charcoal that can be dated using OSL, and the population of all hearths, visible or not. This last category should be completely unaffected by the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hearth_c14&lt;-<span class="st"> </span><span class="kw">NLReport</span>(<span class="st">&quot;[who] of n-of 100 hearths with [ hidden? = false and charcoal? = true ]&quot;</span>)
hearth_osl&lt;-<span class="st"> </span><span class="kw">NLReport</span>(<span class="st">&quot;[who] of n-of 100 hearths with [ hidden? = false ]&quot;</span>)
hearth_null&lt;-<span class="st"> </span><span class="kw">NLReport</span>(<span class="st">&quot;[who] of n-of 100 hearths&quot;</span>)</code></pre></div>
<p>Next, we’ll create three empty tables, or dataframes, each with columns for hearth ID number, X and Y coordinates, and hearth age in years before present.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c14_sample&lt;-<span class="kw">data.frame</span>(<span class="dt">ID=</span><span class="kw">integer</span>(),<span class="dt">X=</span><span class="kw">double</span>(),<span class="dt">Y=</span><span class="kw">double</span>(),<span class="dt">age=</span><span class="kw">integer</span>())
osl_sample&lt;-<span class="kw">data.frame</span>(<span class="dt">ID=</span><span class="kw">integer</span>(),<span class="dt">X=</span><span class="kw">double</span>(),<span class="dt">Y=</span><span class="kw">double</span>(),<span class="dt">age=</span><span class="kw">integer</span>())
null_sample&lt;-<span class="kw">data.frame</span>(<span class="dt">ID=</span><span class="kw">integer</span>(),<span class="dt">X=</span><span class="kw">double</span>(),<span class="dt">Y=</span><span class="kw">double</span>(),<span class="dt">age=</span><span class="kw">integer</span>())</code></pre></div>
<p>Finally, we will go through each entry in our three lists of IDs using a <code>for</code> loop, pull the spatial and chronometric data listed above, and populate the tables with data from the simulated hearth sample.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for (i in <span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">100</span>)){
  c14_sample[i,]&lt;-<span class="kw">c</span>(hearth_c14[i],<span class="kw">NLReport</span>(<span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">&quot;[xcor] of hearth &quot;</span>,hearth_c14[i]),<span class="kw">paste</span>(<span class="st">&quot;[ycor] of hearth &quot;</span>,hearth_c14[i]),<span class="kw">paste</span>(<span class="st">&quot;[age] of hearth &quot;</span>,hearth_c14[i]))))
  osl_sample[i,]&lt;-<span class="kw">c</span>(hearth_osl[i],<span class="kw">NLReport</span>(<span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">&quot;[xcor] of hearth &quot;</span>,hearth_osl[i]),<span class="kw">paste</span>(<span class="st">&quot;[ycor] of hearth &quot;</span>,hearth_osl[i]),<span class="kw">paste</span>(<span class="st">&quot;[age] of hearth &quot;</span>,hearth_osl[i]))))
  null_sample[i,]&lt;-<span class="kw">c</span>(hearth_null[i],<span class="kw">NLReport</span>(<span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">&quot;[xcor] of hearth &quot;</span>,hearth_null[i]),<span class="kw">paste</span>(<span class="st">&quot;[ycor] of hearth &quot;</span>,hearth_null[i]),<span class="kw">paste</span>(<span class="st">&quot;[age] of hearth &quot;</span>,hearth_null[i]))))
}</code></pre></div>
<p>The result should be tables for each of three populations, each containing 100 hearths, their X and Y coordinates, and their age. For those who don’t have NetLogo installed, you can simply enter the following lines to read in the same data from comma-separated value files.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c14_sample&lt;-<span class="kw">read.csv</span>(<span class="st">&quot;c14_hearths.csv&quot;</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
osl_sample&lt;-<span class="kw">read.csv</span>(<span class="st">&quot;osl_hearths.csv&quot;</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)
null_sample&lt;-<span class="kw">read.csv</span>(<span class="st">&quot;null_hearths.csv&quot;</span>,<span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>We can look at the first few entries in each table using the <code>head</code> function. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(c14_sample)</code></pre></div>
<pre><code>##     ID           X         Y  age
## 1 7725  6.03502109 24.182946  456
## 2 6804 11.08510667  4.779465  641
## 3 8573 20.41160048 28.248093  287
## 4 8662 25.97655397 20.660641  269
## 5 5849 26.98930035 30.374603  832
## 6 3928 -0.07997035 29.392092 1216</code></pre>
<p>There is another (far simpler) way to do this using the RNetLogo extension, using the NLGetAgentSet function to obtain information from a subset of agents. For example:</p>
<p><code>c14_sample2&lt;-NLGetAgentSet(c(&quot;who&quot;,&quot;xcor&quot;,&quot;ycor&quot;,&quot;age&quot;),&quot;n-of 100 hearths with [ hidden? = false and charcoal? = true]&quot;,as.data.frame=TRUE)</code></p>
<p>However, the NetLogo software has recently undergone a substantial update, and this function in the RNetLogo package has come into conflict with the new version. I’ve been in touch with developer, who assures me this is being resolved.</p>
</div>
<div id="plotting-the-data" class="section level3">
<h3><span class="header-section-number">4.0.6</span> Plotting the data</h3>
<p>To compare, we’ll plot the ages in chronological order by age. A record weighted toward the present should bend to the left, while a record weighted toward the past should bend to the right.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">sort</span>(null_sample$age),<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">100</span>),<span class="dt">xlab=</span><span class="st">&quot;Years BP&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Index by Age&quot;</span>,<span class="dt">main=</span><span class="st">&quot;&quot;</span>,<span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">2000</span>))
<span class="kw">points</span>(<span class="kw">sort</span>(osl_sample$age),<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">100</span>),<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>)
<span class="kw">points</span>(<span class="kw">sort</span>(c14_sample$age),<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">100</span>),<span class="dt">pch=</span><span class="dv">16</span>)
<span class="kw">abline</span>(-<span class="fl">11.11111111</span>,<span class="fl">0.055555555555555555555</span>,<span class="dt">lty=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="03_Davies_files/figure-html/plot-1.png" width="672" /></p>
<p>The diagonal dashed line shows what would be expected from a uniform record between 2000 and 200 BP. What this shows is the the process as modelled can produce the patterns of increasing frequency toward the present and pronounced gaps in a radiocarbon chronology (black dots), while at the same time showing a less pronounced increase and a lack of notable gaps in the OSL chronology (grey dots). The null distribution effectively follows the dashed line, as expected (unfilled dots).</p>
<p>This is a point of difference from previous explanations. If the gaps in the radiocarbon record were an outcome of periodic human absence from the area, then no hearths should be constructed during the periods of absence; therefore, we should expect to see gaps in both the radiocarbon and OSL chronologies. However, the process in HMODEL can produce a chronometric record where gaps are present in the radiocarbon, but not the OSL.</p>
<p>When these two proxies are compared with data from the field, specifically the Rutherfords Creek study area, we can see a similar trend, where conspicuous gaps in the C14 data are absent from the OSL data, casting doubt on the notion that the gaps are the result of changes in human occupation.</p>
<div class="figure">
<img src="rc_c14_osl_data.jpg" alt="Comparing C14 and OSL data (n=93) from Rutherfords Creek, New South Wales" />
<p class="caption">Comparing C14 and OSL data (n=93) from Rutherfords Creek, New South Wales</p>
</div>
</div>
<div id="quitting-netlogo-from-r" class="section level3">
<h3><span class="header-section-number">4.0.7</span> Quitting NetLogo from R</h3>
<p>In order to quit this session of NetLogo, use the <code>NLQuit</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">NLQuit</span>()</code></pre></div>
<p>Keep in mind that once you have opened a NetLogo file using R, you are not able to open another in the same R session. You will need to restart the R session to open another model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.3.3 (2017-03-06)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 7 x64 (build 7601) Service Pack 1
## 
## locale:
## [1] LC_COLLATE=English_Australia.1252  LC_CTYPE=English_Australia.1252   
## [3] LC_MONETARY=English_Australia.1252 LC_NUMERIC=C                      
## [5] LC_TIME=English_Australia.1252    
## 
## attached base packages:
## [1] methods   stats     graphics  grDevices utils     datasets  base     
## 
## other attached packages:
## [1] RNetLogo_1.0-3 igraph_1.0.1   rJava_0.9-8   
## 
## loaded via a namespace (and not attached):
##  [1] backports_1.0.5 bookdown_0.3.16 magrittr_1.5    rprojroot_1.2  
##  [5] tools_3.3.3     htmltools_0.3.5 yaml_2.1.14     Rcpp_0.12.10   
##  [9] stringi_1.1.3   rmarkdown_1.4   knitr_1.15.17   stringr_1.2.0  
## [13] digest_0.6.12   evaluate_0.10</code></pre>

</div>
</div>

<div class = rmdsale>
Want to know when the book is for sale? Enter your email so we can let you know.
<iframe src="email_submit.html" width="760" height="30" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-linear-models-to-explore-childrens-institutions-in-urban-areas.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tempo-plots-in-r-for-analysing-radiocarbon-dates.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/benmarwick/How-to-do-archaeological-science-using-R/03_Davies.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
